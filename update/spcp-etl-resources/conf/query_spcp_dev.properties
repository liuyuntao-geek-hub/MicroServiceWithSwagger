#SPCP-ETL audit columns
spcp-etl-audit-table=ETL_AUDIT
audit-column-name=last_updt_dtm

#TARGET TABLES
memberTargetTable=MBR_INFO
providerTargetTable=PROVIDER_INFO
pcpGeocodeTargetTable=PCP_GEOCODES
pcpGeocodeRefAdrsTable=REF_ADRS
vbpTargetTable=PCP_VBP
ProdPkgTargetTable=PROD_PKG
ProdPlanTargetTable=PROD_PLAN
reportingTargetTable=RPT_MBR_PCP_DTLS

thrhld_table_load="select * from dv_pdpspcp_xm.SPCP_THRSHLD_TEST"

#PCP_GEOCODES
query_wgsp_pcp_adrs="select trim(hmo_type_cd) AS hmo_type_cd, trim(src_sor_cd) as src_sor_cd, trim(pcp_efctv_dt) AS pcp_efctv_dt, trim(adrs_cnty_cd) AS adrs_cnty_cd, trim(adrs_typ_cd) AS adrs_typ_cd, trim(adrs_id) AS adrs_id, trim(adrs_efctv_dt) AS adrs_efctv_dt, trim(prov_pcp_id) AS prov_pcp_id, upper(trim(adrs_st_cd)) AS adrs_st_cd,trim(adrs_zip_cd) AS adrs_zip_cd, trim(adrs_zip_plus_4_cd) AS adrs_zip_plus_4_cd,upper(trim(adrs_line_1_txt)) AS adrs_line_1_txt,upper(trim(adrs_line_2_txt)) AS adrs_line_2_txt, upper(trim(adrs_city_nm)) AS adrs_city_nm,trim(adrs_cnty_nm) AS adrs_cnty_nm,trim(pa_cmnctn_typ_value) AS pa_cmnctn_typ_value from <cdl-wgsp-db>.WGSP_PCP_ADRS where ADRS_TRMNTN_DT > CURRENT_DATE"
query_ref_adrs="select adrs_line_1_txt, adrs_line_2_txt, adrs_city_nm, adrs_st_cd, adrs_zip_cd, latd_cordnt_nbr, lngtd_cordnt_nbr from dv_pdpspcp_xm.ref_adrs"


#MEMBER DENORMALISATION
query_mem_prod_enrolmnt="select distinct trim(mbr_key) as mbr_key, trim(hc_id) as hc_id from dv_pdpspcp_xm.zz_mbr_prod_enrlmnt where trim(rcrd_stts_cd) = 'ACT' and trim(vrsn_clos_dt) = '8888-12-31'"
query_mem="select trim(mbr_key) as mbr_key, frst_nm,MID_INIT_NM, brth_dt,case when trim(leading '0' from MBR_SQNC_NBR)='' then '0' else trim(leading '0' from MBR_SQNC_NBR) end as MBR_SQNC_NBR,last_nm from dv_pdpspcp_xm.zz_mbr where trim(rcrd_stts_cd) = 'ACT' and trim(vrsn_clos_dt) = '8888-12-31'"
query_xwalk="select mcid, trim(mbr_key) as mbr_key from dv_pdpspcp_xm.zz_pi_mcid_mbr_key_xwalk_all"
query_wgsp_pcp="select trim(hmo_type_cd) as hmo_type_cd,trim(src_sor_cd) as src_sor_cd,pcp_efctv_dt,trim(tax_id) as tax_id, trim(prov_pcp_id) as prov_pcp_id from dv_pdpspcp_xm.zz_wgsp_pcp"
query_wgsp_pcp_altid_mbr="select trim(hmo_type_cd) as hmo_type_cd,trim(src_sor_cd) as src_sor_cd,pcp_efctv_dt,trim(npi) as npi, trim(prov_pcp_id) as prov_pcp_id from dv_pdpspcp_xm.zz_wgsp_pcp_altid where length(trim(npi))=10 and prov_altid_trmntn_dt > current_date and trim(prov_altid_type_cd) = '45'"
query_pi_afnty_atrbn="select a.* from (select trim(prov_org_tax_id) as prov_org_tax_id,trim(ip_npi) as ip_npi,rankg_ordr_nbr,trim(afnty_file_type_cd) as afnty_file_type_cd,mcid,sor_dtm from dv_pdpspcp_xm.zz_pi_afnty_atrbn where trim(rcrd_stts_cd) = 'ACT' and vrsn_clos_dt = '8888-12-31' and trim(afnty_file_type_cd) = 'DFLT') a inner join (select trim(prov_org_tax_id) as prov_org_tax_id,trim(ip_npi) as ip_npi,mcid,max(sor_dtm) as max_sor_dtm from dv_pdpspcp_xm.zz_pi_afnty_atrbn where trim(rcrd_stts_cd) = 'ACT' and vrsn_clos_dt = '8888-12-31' and trim(afnty_file_type_cd) = 'DFLT' group by prov_org_tax_id,ip_npi,mcid) b on a.prov_org_tax_id = b.prov_org_tax_id and a.ip_npi = b.ip_npi and a.mcid = b.mcid and a.sor_dtm = b.max_sor_dtm"


#PROVIDER DENORMALISATION
query_wgsp_pcp="select trim(PROV_PCP_ID) as PROV_PCP_ID, trim(SRC_SOR_CD) as SRC_SOR_CD, trim(HMO_TYPE_CD ) as HMO_TYPE_CD, PCP_EFCTV_DT ,trim(PCP_RANKG_ID ) as PCP_RANKG_ID, trim(PCP_FRST_NM) as PCP_FRST_NM, trim(PCP_MID_NM) as PCP_MID_NM, trim(PCP_LAST_NM) as PCP_LAST_NM, trim(PROV_PRTY_CD) as PROV_PRTY_CD, trim(TAX_ID) as TAX_ID  from <cdl-wgsp-db>.WGSP_PCP"
query_wgsp_pcp_cntrct="SELECT * FROM (SELECT trim(PROV_PCP_ID) as PROV_PCP_ID, trim(LEGCY_NTWK_ID) as LEGCY_NTWK_ID, GRPG_RLTD_PADRS_EFCTV_DT, GRPG_RLTD_PADRS_TRMNTN_DT,MAX_MBR_CNT , CURNT_MBR_CNT, trim(HMO_TYPE_CD) as HMO_TYPE_CD ,trim(SRC_SOR_CD) as SRC_SOR_CD, trim(PCP_EFCTV_DT) as PCP_EFCTV_DT ,trim(RGNL_NTWK_ID) as RGNL_NTWK_ID, trim(CP_TYPE_CD) as CP_TYPE_CD,ROW_NUMBER() OVER (PARTITION BY PROV_PCP_ID, LEGCY_NTWK_ID, MAX_MBR_CNT,CURNT_MBR_CNT, HMO_TYPE_CD, SRC_SOR_CD, PCP_EFCTV_DT, RGNL_NTWK_ID ORDER BY GRPG_RLTD_PADRS_EFCTV_DT, GRPG_RLTD_PADRS_TRMNTN_DT desc) "RNUM" FROM (SELECT * FROM <cdl-wgsp-db>.WGSP_PCP_CNTRCT WHERE GRPG_RLTD_PADRS_TRMNTN_DT>CURRENT_DATE) A) B WHERE B.RNUM = 1;"
query_wgsp_pcp_altid="select trim(PROV_PCP_ID) as PROV_PCP_ID, trim(NPI ) as NPI , trim(SRC_SOR_CD) as SRC_SOR_CD,trim(HMO_TYPE_CD ) as HMO_TYPE_CD , PCP_EFCTV_DT  from <cdl-wgsp-db>.WGSP_PCP_ALTID where length(trim(NPI))=10 and PROV_ALTID_TRMNTN_DT>CURRENT_DATE AND PROV_ALTID_TYPE_CD in ('45', '05')"
query_wgsp_pcp_prov_lang="select trim(PROV_PCP_ID) as PROV_PCP_ID, trim(SRC_SOR_CD) as SRC_SOR_CD, trim(HMO_TYPE_CD ) as HMO_TYPE_CD, PCP_EFCTV_DT, trim(WGS_LANG_CD) as  WGS_LANG_CD, trim(IP_LANG_CD) as IP_LANG_CD  from <cdl-wgsp-db>.WGSP_PCP_PROV_LANG"
query_wgs_spcp_lang_mapping="select trim(WGS_LANG_CD) as WGS_LANG_CD, trim(ENT_LANG_CD) as ENT_LANG_CD, trim(ISO_3_CD) as ISO_3_CD, trim(PCP_LANGUAGE) as PCP_LANGUAGE from <spcp-splice-db>.WGSP_PCP_LANG_MAPPING"
query_wgsp_spclty_cd_mapping="select trim(SPCLTY_CD) as SPCLTY_CD,trim(SPCLTY_DESC) as SPCLTY_DESC, trim(SPCLTY_MNEMONICS) as SPCLTY_MNEMONICS from <spcp-splice-db>.WGSP_PCP_SPCLTY_CD_MAPPING"
query_pcp_geocodes="select  LATD_CORDNT_NBR, LNGTD_CORDNT_NBR, trim(ADRS_LINE_1_TXT ) as ADRS_LINE_1_TXT , trim(ADRS_LINE_2_TXT) as ADRS_LINE_2_TXT,trim(ADRS_CITY_NM) as ADRS_CITY_NM, trim(ADRS_ST_CD ) as ADRS_ST_CD , trim(ADRS_ZIP_CD) as ADRS_ZIP_CD,trim(ADRS_ZIP_PLUS_4_CD) as ADRS_ZIP_PLUS_4_CD, trim(PA_CMNCTN_TYP_VALUE) as PA_CMNCTN_TYP_VALUE, trim(HMO_TYPE_CD) as HMO_TYPE_CD, trim(SRC_SOR_CD) as SRC_SOR_CD,  trim(PCP_EFCTV_DT) as PCP_EFCTV_DT,  trim(ADRS_TYP_CD) as ADRS_TYP_CD, trim(ADRS_ID) as ADRS_ID, trim(ADRS_EFCTV_DT) as ADRS_EFCTV_DT, trim(ADRS_CNTY_CD) as ADRS_CNTY_CD, trim(PROV_PCP_ID) as PROV_PCP_ID from <spcp-splice-db>.PCP_GEOCODES"
query_wgsp_cp_cd_mapping="SELECT trim(CP_TYPE_CD) as CP_TYPE_CD, trim(ACC_NEW_PATIENT_FLAG) as ACC_NEW_PATIENT_FLAG FROM <spcp-splice-db>.WGSP_PCP_CP_CD_MAPPING"
query_vbp_target_table_load="SELECT trim(IP_NPI) as IP_NPI, trim(PROV_ORG_TAX_ID) as PROV_ORG_TAX_ID FROM <spcp-splice-db>.PCP_VBP"
query_wgsp_pcp_asp="select * from (select trim(SPCLTY_CD) as SPCLTY_CD, trim(PROV_PCP_ID) as PROV_PCP_ID, trim(SRC_SOR_CD) as SRC_SOR_CD,trim(HMO_TYPE_CD) as HMO_TYPE_CD, PCP_EFCTV_DT, trim(WGS_SPCLTY_CD) as WGS_SPCLTY_CD, trim(PRMRY_SPCLTY_IND) as PRMRY_SPCLTY_IND, trim(ADRS_TYP_CD) as ADRS_TYP_CD, trim(ADRS_ID) as ADRS_ID, trim(ADRS_EFCTV_DT) as ADRS_EFCTV_DT,ROW_NUMBER() OVER(PARTITION BY SPCLTY_CD, PROV_PCP_ID, SRC_SOR_CD, HMO_TYPE_CD, PCP_EFCTV_DT, WGS_SPCLTY_CD, PRMRY_SPCLTY_IND, ADRS_TYP_CD, ADRS_ID, ADRS_EFCTV_DT ORDER BY ASP_EFCTV_DT DESC) "RNUM" from (select * from <cdl-wgsp-db>.WGSP_PCP_ASP where trim(PRMRY_SPCLTY_IND)='Y' and ASP_TRMNTN_DT>=CURRENT_DATE) A) B where B.RNUM = 1" 
query_wgsp_pcp_vbp_prgm_mapping="select trim(PRGM_TYP) as PRGM_TYP, trim(PRGM_CD) as PRGM_CD, trim(PRGM_DESC) as PRGM_DESC from <spcp-splice-db>.WGSP_PCP_VBP_PRGM_MAPPING"

#VBP tables
query_pi_prov_hrchy="select trim(PG_ID) as PG_ID, trim(PROV_ORG_TAX_ID) as PROV_ORG_TAX_ID, trim(IP_NPI) as IP_NPI FROM <cdl-pims-db>.PI_PROV_HRCHY_OBS where PG_ID NOT LIKE 'OA%' AND  CURRENT_DATE BETWEEN HRCHY_EFCTV_DT AND HRCHY_TRMNTN_DT and RCRD_STTS_CD = 'ACT'"
query_pgm_pg="select trim(PG_ID) as PG_ID, trim(PI_PGM_ID) as PI_PGM_ID FROM <cdl-pims-db>.PGM_PG_OBS where CURRENT_DATE BETWEEN PGM_PG_EFCTV_DT AND PGM_PG_TRMNTN_DT AND RCRD_STTS_CD = 'ACT'"
query_pi_pgm="select trim(PI_PGM_ID) as PI_PGM_ID, trim(PGM_TYPE_CD) as PGM_TYPE_CD FROM <cdl-pims-db>.PI_PGM_OBS where CURRENT_DATE BETWEEN PGM_EFCTV_DT AND PGM_TRMNTN_DT AND RCRD_STTS_CD = 'ACT'"
query_pi_pgm_lob="select trim(PI_PGM_ID) as PI_PGM_ID, trim(LOB_ID) as LOB_ID, PGM_LOB_EFCTV_DT FROM <cdl-pims-db>.PI_PGM_LOB_OBS where CURRENT_DATE BETWEEN PGM_LOB_EFCTV_DT AND PGM_LOB_TRMNTN_DT AND LOB_ID = 'Commercial'   AND RCRD_STTS_CD = 'ACT'"
query_pgm_lob_psl="select trim(LOB_ID) as LOB_ID, PGM_LOB_EFCTV_DT FROM <cdl-pims-db>.PGM_LOB_PSL_OBS where CURRENT_DATE BETWEEN PGM_LOB_PSL_EFCTV_DT AND PGM_LOB_PSL_TRMNTN_DT AND RCRD_STTS_CD = 'ACT'"
query_pgm_lob_psl_parm="select trim(PI_PGM_ID) as PI_PGM_ID, trim(LOB_ID) as LOB_ID, PGM_LOB_EFCTV_DT FROM <cdl-pims-db>.PGM_LOB_PSL_PARM_OBS where RPTG_ONLY_IND = '2' AND CURRENT_DATE BETWEEN PSL_PARM_EFCTV_DT AND PSL_PARM_TRMNTN_DT"

#PRODUCT TABLE QUERIES
query_prod_pkg="select trim(PROD.SRC_PROD_TYPE_CD) as SRC_PROD_TYPE_CD , trim(BNFT_PKG.BNFT_PKG_ID) as BNFT_PKG_ID,trim(BNFT_PKG.BNFT_PKG_KEY) as BNFT_PKG_KEY,trim(BNFT_PKG.PROD_SOR_CD) as PROD_SOR_CD,trim(PROD.HLTH_PROD_SRVC_TYPE_CD) as HLTH_PROD_SRVC_TYPE_CD,trim(PROD.PROD_ID) as PROD_ID From dv_pdpspcp_xm.BNFT_PKG BNFT_PKG,dv_pdpspcp_xm.PROD PROD WHERE BNFT_PKG.PROD_SOR_CD = PROD.PROD_SOR_CD AND BNFT_PKG.PROD_ID = PROD.PROD_ID AND BNFT_PKG.PROD_SOR_CD IN ('812','813','814')"
query_prod_plan="SELECT  trim(T3.PLAN_ID) as PLAN_ID,trim(T3.PROD_FMLY_TYPE_CD) as PROD_FMLY_TYPE_CD ,T3.PLAN_EFCTV_DT,T3.PLAN_TRMNTN_DT,T3.BNFT_PKG_ADDNL_EFCTV_DT,trim(T4.BNFT_PKG_KEY) as BNFT_PKG_KEY,trim(T4.BNFT_PKG_ID) as BNFT_PKG_ID,trim(T4.PROD_SOR_CD) as PROD_SOR_CD ,TRIM(T3.PLAN_ST_CD) AS PLAN_ST_CD FROM (SELECT T1.PLAN_ST_CD,T1.PLAN_ID,T1.PROD_FMLY_TYPE_CD,T1.PLAN_EFCTV_DT,T1.PLAN_TRMNTN_DT,T2.BNFT_PKG_ADDNL_EFCTV_DT,T2.BNFT_PKG_KEY FROM (SELECT * FROM (SELECT trim(A.PLAN_ID) as PLAN_ID, A.SOR_DTM, trim(A.PROD_FMLY_TYPE_CD) as PROD_FMLY_TYPE_CD, A.PLAN_EFCTV_DT, trim(A.PLAN_ST_CD) as PLAN_ST_CD, A.PLAN_TRMNTN_DT,ROW_NUMBER() OVER (PARTITION BY A.PLAN_ID ORDER BY A.SOR_DTM DESC) "RNUM1" FROM (SELECT * FROM DV_PDPSPCP_XM.PLAN  WHERE PROD_SOR_CD='1000') A ) B WHERE B.RNUM1 = 1) T1 INNER JOIN(SELECT * FROM (SELECT trim(C.BNFT_PKG_KEY) as BNFT_PKG_KEY, trim(C.PLAN_ID) as PLAN_ID, C.SOR_DTM, C.BNFT_PKG_ADDNL_EFCTV_DT, ROW_NUMBER() OVER (PARTITION BY C.BNFT_PKG_KEY, C.PLAN_ID ORDER BY C.SOR_DTM DESC) "RNUM2" FROM (SELECT * FROM dv_pdpspcp_xm.CNTRCT_PLAN WHERE PROD_SOR_CD='1000') C) D WHERE D.RNUM2 = 1) T2 ON T1.PLAN_ID = T2.PLAN_ID) T3 INNER JOIN(SELECT trim(BNFT_PKG_KEY) as BNFT_PKG_KEY, trim(BNFT_PKG_ID) as BNFT_PKG_ID, trim(PROD_SOR_CD) as PROD_SOR_CD FROM dv_pdpspcp_xm.BNFT_PKG WHERE PROD_SOR_CD='1000') T4 ON T3.BNFT_PKG_KEY = T4.BNFT_PKG_KEY"

#VARIANCE
variance_tbl_list="MBR_INFO,PROVIDER_INFO"
query_variance="SELECT CURRENT_DATE AS LOAD_DT, varTbl.TABLE_NM AS TABLE_NM, tbl.CURRENT_CNT  AS ROW_CNT, varTbl.PREV_ROW_CNT AS PREV_ROW_CNT,CASE WHEN varTbl.PREV_ROW_CNT =0.0 THEN 100.0	ELSE ((tbl.CURRENT_CNT - varTbl.PREV_ROW_CNT)/ varTbl.PREV_ROW_CNT)*100.0 END AS VARIANCE FROM (SELECT TABLE_NM,ROW_CNT AS PREV_ROW_CNT  FROM <spcp-splice-db>.SPCP_AUDIT_VARIANCE WHERE TABLE_NM = <table_name> ORDER BY CREATED_DT DESC {LIMIT 1} ) varTbl  JOIN (SELECT <table_name> AS TABLE_NM, count(*) AS CURRENT_CNT  FROM <spcp-splice-db>.<table_name>) tbl  ON tbl.TABLE_NM=varTbl.TABLE_NM "
query_spcp_audit_thrshld="SELECT TABLE_NM, THRSHLD_LIMIT FROM <spcp-splice-db>.SPCP_AUDIT_THRSHLD"

#REPORTING-ETL
query_mbr_pcp="select trim(rptg_prov_id) as rptg_prov_id, trim(mbr_key) as mbr_key, trim(mbrshp_sor_cd) as mbrshp_sor_cd, mbr_prod_enrlmnt_efctv_dt, trim(prod_ofrg_key) as prod_ofrg_key, trim(sor_dtm) as sor_dtm, trim(src_pcp_asgnmnt_mthd_cd) as src_pcp_asgnmnt_mthd_cd, pcp_efctv_dt from S01_CDLEDWD_ALLPHI_XM.MBR_PCP where trim(rcrd_stts_cd) <> 'DEL' and trim(mbrshp_sor_cd) in ('808','815')"
query_cmpny_cf="select trim(cmpny_cf_cd) as cmpny_cf_cd, trim(cmpny_st_cd) as cmpny_st_cd from S01_CDLRFDM_ALLPHI_XM.cmpny_cf"
query_mpe_coa="select trim(mbr_key) as mbr_key, mbr_prod_enrlmnt_efctv_dt, trim(prod_ofrg_key) as prod_ofrg_key, trim(cmpny_cf_cd) as cmpny_cf_cd, trim(mbu_cf_cd) as mbu_cf_cd from S01_CDLEDWD_ALLPHI_XM.mbr_prod_enrlmnt_coa where trim(rcrd_stts_cd) <> 'DEL' and trim(mbrshp_sor_cd) in ('808','815')"
query_mpe="select trim(mbr_key) as mbr_key, trim(prod_ofrg_key) as prod_ofrg_key, mbr_prod_enrlmnt_efctv_dt, trim(mbrshp_sor_cd) as mbrshp_sor_cd, trim(hc_id) as hc_id from S01_CDLEDWD_ALLPHI_XM.mbr_prod_enrlmnt where trim(rcrd_stts_cd) <> 'DEL'"
query_mbr_reprtng="select trim(mbr_key) as mbr_key, trim(mbrshp_sor_cd) as mbrshp_sor_cd, trim(mbr_sqnc_nbr) as mbr_sqnc_nbr, trim(frst_nm) as frst_nm, trim(last_nm) as last_nm from S01_CDLEDWD_ALLPHI_XM.mbr where trim(rcrd_stts_cd) <> 'DEL'"
query_hca_prov_ranking="select trim(adrs_st_cd) as adrs_st_cd, trim(prov_id) as prov_id, mdo_ranking, trim(tax_id) as tax_id, trim(name) as name from DV_PDPSPCP_XM.HCA_PROV_RANKING"
query_provider_info="select * from DV_PDPSPCP_XM.PROVIDER_INFO"
query_prod_ofrg="select trim(prod_ofrg_key) as prod_ofrg_key, trim(mbrshp_sor_cd) as mbrshp_sor_cd, trim(bnft_pkg_key) as bnft_pkg_key from TS_CDLEDWD_ALLPHI_XM.PROD_OFRG"
query_prod_plan_reporting="select trim(bnft_pkg_key) as bnft_pkg_key from DV_PDPSPCP_XM.PROD_PLAN"
rcode_mapping_query="select trim(rcode) as rcode, trim(assignment_type) as assignment_type from DV_PDPSPCP_XM.PCP_ASGNMNT_RCODE_MAPPING"